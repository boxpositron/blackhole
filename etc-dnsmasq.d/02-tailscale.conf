# ======================================
# Tailscale-specific dnsmasq Configuration
# ======================================
# This file is automatically loaded by Pi-hole's dnsmasq
# Place in ./etc-dnsmasq.d/ directory

# Listen on Tailscale interface
# Automatically detected when using network_mode: service:tailscale
interface=tailscale0

# Bind to localhost (Pi-hole FTL handles the rest)
listen-address=127.0.0.1
listen-address=::1

# Forward Tailscale MagicDNS queries to Tailscale's DNS
# This allows resolution of *.ts.net domains
server=/ts.net/100.100.100.100

# Disable DNS rebinding protection for Tailscale domains
# Required for MagicDNS to work properly
rebind-domain-ok=/ts.net/

# Cache configuration for optimal performance
cache-size=25000
dns-forward-max=1000

# Enable negative caching (cache failed lookups)
# Reduces upstream queries for non-existent domains
neg-ttl=3600

# Enable query parallelization
# Speeds up DNS resolution
all-servers

# Local domain configuration (optional)
# Uncomment and customize for your local network
# local=/home.arpa/
# domain=home.arpa
# expand-hosts

# DNSSEC validation - ENABLED for security
# Protects against DNS spoofing and cache poisoning attacks
# Performance impact is minimal (< 5ms additional latency)
dnssec
dnssec-check-unsigned
trust-anchor=.,20326,8,2,E06D44B80B8F1D39A95C0B0D7C65D08458E880409BBC683457104237C7F8EC8D

# Logging (for debugging - disable in production)
# log-queries
# log-facility=/var/log/pihole/pihole.log

# Custom DNS records
# Add your custom local DNS entries below
# Examples:
# address=/myserver.local/192.168.1.100
# address=/homeassistant.local/192.168.1.50
# cname=www.myserver.local,myserver.local
